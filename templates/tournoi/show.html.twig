{% extends 'base.html.twig' %}

{% block title %}Tournoi
{% endblock %}

{% block body %}
<div class="main-content">
	<div id="ancre" class="head-trd">
		<div class="logo-nom">
			<img class="logo-trd" src="{{ vich_uploader_asset(tournoi, 'logoFile') }}" alt="Logo du tournoi" />
			<a href="">{{ tournoi.nomTournoi }}</a>
		</div>

		{% if app.user and tournoi.organisateur.id != app.user.id %}
			<div class="contact-user">
				{# Icon pour contacter l'organisateur d'un tournoi #}
				<i id="chat-icon" class="fa-regular fa-message chat-icon"
					data-organisateur-id="{{ tournoi.organisateur.id }}"></i>
			</div>
		{% endif %}
	</div>
	<h2 class="title-organisation">{{ tournoi.nomOrganisation | upper }}</h2>
	<div class="tab-bar">
		<div class="tab-container">
			<div class="tab" id="tab-regles" onclick="openTab('regles')">REGLES</div>
			<div class="tab" onclick="openTab('participants')">PARTICIPANTS</div>
			<div class="tab" onclick="openTab('matchs')">MATCHS</div>
			<!-- Plus de tabs si nécessaire -->
		</div>
	</div>

	<div id="regles" class="content">
		<img class="banner-tr" src="{{ vich_uploader_asset(tournoi, 'banniereTrFile') }}" alt="Bannière du tournoi">
		<hr class="line-tr">
		<p id="title-propos-tr">A PROPOS DE CE TOURNOI : {{ tournoi.jeu | upper }}</p>

		{# Description du tournoi #}
		<div class="tr-desc-regles">
			{{ tournoi.description | raw }}
		</div>
	</div>
	<div id="participants" class="content" style="display:none;">
		<p>JOUEURS INSCRITS (<span id="nbJoueurs">{{ tournoi.participantTournois | length }}</span>)</p>
		{% for participant in tournoi.participantTournois %}
		<a class="participant" href="{{ path('app_user_profil', {'id': participant.utilisateur.id}) }}">
			<div class="list-participants">
				{% if participant.utilisateur.photoFile %}
				<img style="width: 40px; height:40px;"
					src="{{ vich_uploader_asset(participant.utilisateur, 'photoFile') }}" alt="photo de profil">
				{% else %}
				<img style="width: 40px; height:40px;" src="/img/defaultProfile.png" alt="photo de profil">
				{% endif %}
				<p>{{ participant.utilisateur.pseudo }}</p>
			</div>
		</a>
		{% endfor %}
	</div>
	<div id="matchs" class="content" style="display:none;">
		<p>Matchs</p>
		<ul>
			{% for index, match in tournoi.getGameMatches %}
			<li>
				{{ index + 1 }}:
				{{ match.dateDebut | format_datetime('short', 'short', locale='fr') }}
			</li>
			{% endfor %}
		</ul>
	</div>
</div>

<div class="tr-join-status">
	<div class="tr-status">
		{% if tournoi.nbJoueurs < tournoi.nbJoueursMax %} 
		<h4>ENREGISTREMENT OUVERT</h4>
			{% else %}
			<h4>ENREGISTREMENT FERMEE</h4>
			{% endif %}
			<p id="nbJoueurs">{{ tournoi.participantTournois | length }} / {{ tournoi.nbJoueursMax }} Joueurs
				enregistrés</p>
			<a style="font-size: 25px; position:absolute; right:10px; color:white;" href="#ancre">
				<i class="fa-regular fa-circle-up"></i>
			</a>
	</div>
	<div class="btn-join-tr">
		<span id="rejoindre-tr">REJOINDRE</span>
		{% if app.user %}
			{% if not isAlreadyParticipate and tournoi.nbJoueurs < tournoi.nbJoueursMax %}
				<form action="{{ path('tournoi_participer', {'id': tournoi.id}) }}" method="POST">
					<button type="submit">Participer</button>
				</form>
			{% elseif not isAlreadyParticipate and tournoi.nbJoueurs >= tournoi.nbJoueursMax %}
				<button id="btnParticiper" disabled>Participer</button>
			{% endif %}

			{% if isAlreadyParticipate and app.user %}
				<form action="{{ path('tournoi_quitter', {'id': tournoi.id}) }}" method="POST">
					<button type="submit">Quitter</button>
				</form>
			{% endif %}


		{% endif %}

	</div>
</div>
{% endblock %}

		{# {% if app.user is not null and tournoi.organisateur.id == app.user.id %} #}
		{# <a href="{{ path('new_match', {'id' : tournoi.id}) }}">Ajouter un match</a>
		<a href="{{ path('app_tournoi_edit', {'id' : tournoi.id}) }}">Edit</a> #}
		{# {{ include('tournoi/_delete_form.html.twig') }} #}